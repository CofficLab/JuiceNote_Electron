# 结构体

<div class="o">https://go.dev/ref/spec#Struct_types</div>

## 简介

结构体 是一个复合数据类型，它可以将零个或多个字段组合在一起。

```go
type Date struct {
    Year int
    Month int
    Day int
}
```

## 初始化

<div class="run"></div>

```go
package main
import "fmt"
import "reflect"

type Date struct {
    Year int
    Month int
    Day int
}

func main() {
    date := Date{Year: 2020, Month: 5, Day: 2}

    fmt.Println(reflect.TypeOf(date))
    fmt.Print(date)
}
```

也可以这样：

<div class="run"></div>

```go
package main
import "fmt"
import "reflect"

type Date struct {
    Year int
    Month int
    Day int
}

func main() {
    date := Date{}
    date.Year = 2020
    date.Month = 5
    date.Day = 2

    fmt.Println(reflect.TypeOf(date))
    fmt.Print(date)
}
```

## 关联函数

### 关联到结构体

### 关联到结构体指针

<div class="run"></div>

```go
package main

import "fmt"

type Dog struct {
  Name string
}

func (this *Dog) Shout() {
  fmt.Println("汪汪汪")
}

func main() {
    dog := &Dog{Name: "123"}
    dog.Shout()
}
```

<div class="ask">如何理解上面的代码？</div>

`*Dog` 类型是 Shout 方法的接受者。然后我们可以通过下面的代码去调用 Super 方法：

```go
dog := &Dog{Name: "123"}
dog.Shout()
```

## 构造器

结构体没有构造器。但是，你可以创建一个返回所期望类型的实例的函数（类似于工厂）：

```go
func NewSaiyan(name string, power int) *Saiyan {
  return &Saiyan{
    Name: name,
    Power: power,
  }
}
```

这种模式以错误的方式惹恼了很多开发人员。一方面，这里有一点轻微的语法变化；另一方面，它确实感觉有点不那么明显。

我们的工厂不必返回一个指针；下面的形式是完全有效的：

```go
func NewSaiyan(name string, power int) Saiyan {
  return Saiyan{
    Name: name,
    Power: power,
  }
}
```

## 新建

<div class="run"></div>

```go
package main
import "fmt"
import "reflect"

type Dog struct {
    Name string
}

func main() {
    dog := new(Dog)
    dog.Name = "123"

    fmt.Println(reflect.TypeOf(dog), dog)
}
```

也可以这样：

<div class="run"></div>

```go
package main
import "fmt"
import "reflect"

type Dog struct {
    Name string
}

func main() {
    dog := &Dog{Name: "123"}

    fmt.Println(reflect.TypeOf(dog), dog)
}

```

以下两种写法是等价的：

```go
dog := new(Dog)
```

```go
dog := &Dog{}
```

## 组合

Go 支持将一个结构体包含进另一个结构体的行为。

<div class="run"></div>

```go
package main
import "fmt"

type Animal struct {
  Legs int
}

func (this *Animal) Introduce() {
  fmt.Printf("早上好，我有 %d 条腿", this.Legs)
}

type Dog struct {
  *Animal
  Name string
}

func main() {
  dog := &Dog{
    Animal: &Animal{Legs: 4},
    Name: "123",
  }

  dog.Introduce()
}
```

Dog 结构体有一个 Animal 类型的字段。有两种方式访问 Animal 类型中的字段：

- `dog.Animal.Legs`
- `dog.Legs`

<div class="run"></div>

```go
package main
import "fmt"

type Animal struct {
  Legs int
}

func (this *Animal) Introduce() {
  fmt.Printf("早上好，我有 %d 条腿", this.Legs)
}

type Dog struct {
  *Animal
  Name string
}

func main() {
  dog := &Dog{
    Animal: &Animal{Legs: 4},
    Name: "123",
  }

  fmt.Println(dog.Legs)
  fmt.Println(dog.Animal.Legs)
}
```
