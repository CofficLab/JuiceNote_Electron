# 性能

## 性能指标

### 响应时间

指的是某个请求从发出到接收到响应所消耗的时间。

在对响应时间进行测试时，通常采用重复请求的方式，然后计算平均响应时间。

<div class="run"></div>

```js
const http = require("http");
const server = http.createServer((req, res) => {
  res.end("pang");
});
server.listen(8000);

setTimeout(() => {
  console.log("关闭服务器");
  server.close();
}, 10000);
```

运行上述代码，在 `127.0.0.1:8000` 启动一个服务，然后运行如下代码：

<div class="run"></div>

```sh
ab -n 100 -c 1 'http://127.0.0.1:8000/'
```

### 吞吐量

指系统在单位时间内可以处理的请求数量，通常使用每秒的请求数来衡量。

### 并发用户数

指系统能同时处理的并发用户请求数量。

在没有并发存在的系统中，请求被顺序执行，此时响应时间为吞吐量的倒数。

例如：

系统的吞吐量为 100 req/s，那么平均响应时间应该为 0.01s。

目前的大型系统都支持多线程来处理并发请求，多线程能够提高吞吐量以及缩短响应时间，主要有两个原因：

- 多 CPU
- IO 等待时间

使用 IO 多路复用等方式，系统在等待一个 IO 操作完成的这段时间内不需要被阻塞，可以去处理其他请求。

通过将这个等待时间利用起来，使得 CPU 利用率大大提高。

并发用户数并不是越高越好，因为如果并发用户数太高，系统来不及处理这么多的请求，会使得过多的请求需要等待，那么响应时间就会大大提高。

## 性能优化

### 集群

将多台服务器组成集群，使用负载均衡将请求转发到集群中，避免单一服务器的负载压力过大导致性能降低。

### 缓存

缓存能够提高性能的原因如下：

- 缓存数据通常位于内存等介质中，这种介质对于读操作特别快；
- 缓存数据可以位于靠近用户的地理位置上；
- 将计算结果进行缓存，从而避免重复计算。

### 异步

某些流程可以将操作转换为消息，将消息发送到消息队列后立即返回，之后这个操作会被异步处理。
