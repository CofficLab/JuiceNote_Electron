# 屏幕抓取

屏幕抓取是通过程序下载网页并从中提取信息的过程。这种技术很有用，在网页中有你要在 程序中使用的信息时，就可使用它。当然，如果网页是动态的，即随时间而变化，这就更有用了。 如果网页不是动态的，你可手工下载一次并提取其中的信息。(当然，最理想的情况是，可通过 Web 服务来获取这些信息，这将在本章后面讨论。)
从概念上说，这种技术非常简单:下载数据并对其进行分析。例如，你可使用 urllib 来获取 网页的 HTML 代码，再使用正则表达式(参见第 10 章)或其他技术从中提取信息。例如，假设你 要从 Python Job Board(http://python.org/jobs)提取招聘单位的名称和网站。通过查看该网页的源 代码，你发现可在类似于下面的链接中找到名称和 URL:

```html
<a href="/jobs/1970/">Python Engineer</a>
```

```python3
from urllib.request import urlopen
import re
p = re.compile('<a href="(/jobs/\\d+)/">(.*?)</a>')
text = urlopen('http://python.org/jobs').read().decode() for url, name in p.findall(text):
print('{} ({})'.format(name, url))
```

这些代码当然有改进的空间，但已经做得非常出色了。然而，这种方法至少存在以下缺点：

- 正则表达式一点都不容易理解。如果 HTML 代码和查询都更复杂，正则表达式将更难以理
  解和维护。
- 它对付不了独特的 HTML 内容，如 CDATA 部分和字符实体(如&amp;)。遇到这样的东西 时，这个程序很可能束手无策。

正则表达式依赖于 HTML 代码的细节，而不是更抽象的结构。这意味着只要网页的结构发生 细微的变化，这个程序可能就不管用(等你阅读本书时，它可能已经不管用了)。
针对基于正则表达式的方法存在的问题，接下来将讨论两种可能的解决方案。一是结合使用 程序 Tidy(一个 Python 库)和 XHTML 解析;二是使用专为屏幕抓取而设计的 Beautiful Soup 库。

<script>
function run(target) {
    if (window.runner == undefined) {
        alert('在APP版本中才可以运行')
        return
    }

    if (target.innerHTML == '收起') {
        target.innerHTML = '运行'
        target.parentElement.getElementsByTagName('pre').item(0).style.display = 'none'
    } else {
        target.innerHTML = '收起'
        code = target.parentElement.parentElement.getElementsByTagName('code').item(0).innerText
        result = window.runner(code,'python')
        target.parentElement.getElementsByTagName('code').item(0).innerHTML = result
        target.parentElement.getElementsByTagName('pre').item(0).style.display = 'block'
    }
}
</script>
