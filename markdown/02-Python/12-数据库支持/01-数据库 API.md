# 数据库 API

数据库 API 是一种连接到 SQL 数据库的标准化方式。

本文使用的数据库是： SQLite。

## 全局变量

所有与 DB API2.0 兼容的数据库模块都必须包含三个全局变量，它们描述了模块的特征。这 样做的原因是，这个 API 设计得很灵活，无需进行太多包装就能配合多种不同的底层机制使用。 如果要让程序能够使用多种不同的数据库，可能会比较麻烦，因为需要考虑众多不同的可能性。 在很多情况下，一种更现实的做法是检查这些变量，看看给定的模块是否是程序能够接受的。如 果不是，就显示合适的错误消息并退出或者引发异常。表 13-1 总结了这些全局变量。
API 级别(apilevel)是一个字符串常量，指出了使用的 API 版本。DB API 2.0 指出，这个变 10 量的值为'1.0'或'2.0'。如果没有这个变量，就说明模块不与 DB API 2.0 兼容，应假定使用的是
DB API 1.0。编写代码时，允许这个变量为其他值也没有害处，因为说不定什么时候 DB API 3.0 就出来了。
线程安全程度(threadsafety)是一个 0~3(含)的整数。0 表示线程不能共享模块，而 3 表 示模块是绝对线程安全的。1 表示线程可共享模块本身，但不能共享连接(参见 13.1.3 节)，而 2 表示线程可共享模块和连接，但不能共享游标。如果你不使用线程(在大多数情况下可能不会是 这样的)，就根本不用关心这个变量。
参数风格(paramstyle)表示当你执行多个类似的数据库查询时，如何在 SQL 查询中插入参 数。'format'表示标准字符串格式设置方式(使用基本的格式编码)，如在要插入参数的地方插 入%s。'pyformat'表示扩展的格式编码，即旧式字典插入使用的格式编码，如%(foo)s。除这些 Python 风格外，还有三种指定待插入字段的方式:'qmark'表示使用问号，'numeric'表示使用:1 和:2 这样的形式表示字段(其中的数字是参数的编号)，而'named'表示使用:foobar 这样的形式表示字段(其中 foobar 为参数名)。如果你觉得参数样式令人迷惑，也不用担心。编写简单程序时，
不会用到它们。如果需要明白特定的数据库是如何处理参数的，可参阅相关的文档。

## 异常

DB API 定义了多种异常，让你能够细致地处理错误。然而，这些异常构成了一个层次结构， 因此使用一个 except 块就可捕获多种异常。当然，如果你觉得一切都正常运行，且不介意出现不 太可能出现的错误时关闭程序，可以根本不考虑这些异常。
表 13-2 说明了这个异常层次结构。异常应该在整个数据库模块中都可用。有关这些异常的深 入描述，请参阅 DB API 规范(前面提到的 PEP)。

## 连接和游标

要使用底层的数据库系统，必须先连接到它，为此可使用名称贴切的函数 connect。这个函 数接受多个参数，具体是哪些取决于要使用的数据库。作为指南，DB API 定义了表 13-3 所示的参 数。推荐将这些参数定义为关键字参数，并按表 13-3 所示的顺序排列。这些参数都应该是字符串。
